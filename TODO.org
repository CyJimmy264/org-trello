#+title: TODO orgtrello's dev progress
#+author: Antoine R. Dumont
#+property: board-id      50bcfd2f033110476000e768
#+property: todo-list-id  51d15c319c93af375200155f
#+property: doing-list-id 51d15c98741fd4673a0014b5
#+property: done-list-id  50bcfd2f033110476000e76b

* IN-PROGRESS Development steps [79%]
** DONE emacs-lisp HTTP Client
CLOSED: [2013-06-29 sam. 15:29]
** DONE authentication in trello
CLOSED: [2013-06-29 sam. 15:29]
** DONE http request on trello api
CLOSED: [2013-06-29 sam. 15:29]
** DONE api tinkering (see [[https://github.com/ardumont/trello-lab][ardumont/trello-lab]] on github)
CLOSED: [2013-06-29 sam. 15:29]
** DONE porting tinkering results into emacs-lisp
CLOSED: [2013-06-30 dim. 13:37]
** DONE testing
CLOSED: [2013-06-29 sam. 15:29]
** DONE testing in batch mode
CLOSED: [2013-06-29 sam. 16:49]
** DONE Define use case
CLOSED: [2013-06-29 sam. 16:49]
** DONE trying out the results interactively
CLOSED: [2013-06-30 dim. 00:13]
** DONE Finding out the org-mode hooks [100%]           :howTo:emacs:orgMode:
CLOSED: [2013-07-01 lun. 10:58]
http://orgmode.org/worg/org-configs/org-hooks.html
http://orgmode.org/worg/doc.html
1) org-after-todo-state-change-hook
2) etc...
*** DONE hook that seems interesting for the goal at end
CLOSED: [2013-06-30 dim. 15:47]
- org-cycle-hook
- org-after-todo-state-change-hook
- org-insert-heading-hook
- org-after-promote-entry-hook
- org-after-demote-entry-hook
*** DONE miscellaneous functions that seems useful for the goat at end
CLOSED: [2013-07-01 lun. 08:05]
- org-cycle
- org-current-level
- org-heading-components
- org-block-todo-from-children-or-siblings-or-parent
- org-entry-is-done-p
- org-entry-is-todo-p
- save-excursion
- org-back-to-heading
- org-next-item
- org-list-has-child-p
- org-list-get-parent
- org-list-get-children
- org-list-get-subtree
*** CANCELLED Hooks [80%]
CLOSED: [2013-07-02 mar. 18:55]
**** DONE state change for an item - org-trigger-hook (look also to org-after-todo-state-change-hook)
CLOSED: [2013-06-30 dim. 16:21]
Adding a simple function that displays a message to the org-trigger-hook.
**** DONE create new task (org-insert-heading-hook
CLOSED: [2013-06-30 dim. 16:28]
**** DONE promote a task (org-after-promote-entry-hook
CLOSED: [2013-06-30 dim. 16:39]
**** DONE demote a task (org-after-demote-entry-hook)
CLOSED: [2013-06-30 dim. 16:40]
**** TODO delete task (?)
** DONE Finding out howto make an emacs minor mode             :howTo:emacs
CLOSED: [2013-07-01 lun. 08:04]
https://www.gnu.org/software/emacs/manual/html_node/emacs/Modes.html#Modes
http://nullprogram.com/blog/2013/02/06/
** DONE function generating metadata
CLOSED: [2013-07-01 lun. 10:58]
*** org-current-level
Compute the current level (number of stars)
*** org-get-heading
return the title heading
*** org-heading-components
return the list of metadata (including title, keyword and level)
** DONE Find org function that extract information from line (org-heading-components)
CLOSED: [2013-07-01 lun. 11:00]
** DONE Develop simple function to compute the needed data only
CLOSED: [2013-07-01 lun. 11:00]
** DONE Plug the call of a function that displays such informations in a hook
CLOSED: [2013-07-01 lun. 11:00]
** DONE Plug the call of a function that displays such informations with a binding
CLOSED: [2013-07-01 lun. 11:00]
** DONE binding to describe the current heading
CLOSED: [2013-07-01 lun. 16:00]
** DONE Depending on the level, trigger the right api call
CLOSED: [2013-07-02 mar. 18:50]
*** DONE Dispatch on the level
CLOSED: [2013-07-01 lun. 12:15]
*** DONE Basic [100%]
CLOSED: [2013-07-01 lun. 22:35]
**** DONE level 1 - api create trello card
CLOSED: [2013-07-01 lun. 12:44]
- simple display of the api call result
- plug the call
**** DONE level 1 - http call to create the card
CLOSED: [2013-07-01 lun. 16:00]
**** DONE level 2 - update trello card
CLOSED: [2013-07-01 lun. 16:00]
**** DONE level 2 - create trello checklist
CLOSED: [2013-07-01 lun. 21:46]
**** DONE level 2 - update trello checklist
CLOSED: [2013-07-01 lun. 21:46]
**** DONE level 3 - create trello item
CLOSED: [2013-07-01 lun. 21:59]
**** DONE level 3 - update trello item
CLOSED: [2013-07-01 lun. 22:19]
**** DONE > level 4 - display that we do not deal with such level
CLOSED: [2013-07-01 lun. 22:35]

*** DONE Depending on the card's state (level 1 entry), move the card to the list (todo, doing, done) [100%]
CLOSED: [2013-07-02 mar. 18:43]
**** DONE Find id board
CLOSED: [2013-07-02 mar. 17:02]

from [[https://github.com/ardumont/trello-lab][trello-lab]]:
#+begin_src clojure
trello-lab.playground> (-> board1
                           :id
                           lists
                           query/execute
                           clojure.pprint/pprint)
[{:id "51d15c319c93af375200155f",
  :name "Todo",
  :closed false,
  :idBoard "50bcfd2f033110476000e768",
  :pos 1536,
  :subscribed false}
 {:id "51d15c98741fd4673a0014b5",
  :name "Doing",
  :closed false,
  :idBoard "50bcfd2f033110476000e768",
  :pos 3072,
  :subscribed false}
 {:id "50bcfd2f033110476000e76b",
  :name "Done",
  :closed false,
  :idBoard "50bcfd2f033110476000e768",
  :pos 263168,
  :subscribed false}]
#+end_src

**** DONE code the id to look for depending on the state
CLOSED: [2013-07-02 mar. 18:43]
** DONE Adding org metadata file `a la` #+BOARD-ID, #+TODO-LIST-ID, #+DOING-LIST-ID, #+DONE-LIST-ID to permit the user to setup easily without touching lisp code
CLOSED: [2013-07-01 lun. 23:31]
Adding this:
#+begin_src org-mode
# +property: board-id      <board-id>
# +property: todo-list-id  <todo-list-id>
# +property: doing-list-id <doing-list-id>
# +property: done-list-id  <done-list-id>
#+end_src
Note: # + instead of #+ to avoid org-mode capturing the bad ones.

** DONE Make orgtrello a minor mode for org-mode
CLOSED: [2013-07-02 mar. 16:36]
** DONE create/update trello card from top (card) to bottom (items)
CLOSED: [2013-07-02 mar. 22:24]
*** DONE Retrieve all the list - org-map-tree
CLOSED: [2013-07-02 mar. 22:20]
*** DONE A binding to describe the extraction of all data
CLOSED: [2013-07-02 mar. 22:21]
*** DONE Trigger the creation of the card and every level up to 3 (checklist + task)
CLOSED: [2013-07-03 mer. 14:15]
- At the moment, need to create the card first
- Then hit again, this will create the checklists
- Then hit again, this will create the tasks
Why? Do not know why yet!

- Limit: I had to make the http request synchronous

** DONE Improve the callback (at the moment, the id is written where the carret is, so if we move while a http request takes place, the id is written badly)
CLOSED: [2013-07-03 mer. 00:47]
** DONE Improve the id generation and use the properties instead of tags (cf. org2blog)
CLOSED: [2013-07-03 mer. 01:25]
** IN-PROGRESS Delete [0%]
*** PENDING card
**** DONE api call
CLOSED: [2013-07-03 mer. 17:18]
**** TODO plug
*** PENDING checklist
**** DONE api call
CLOSED: [2013-07-03 mer. 17:18]
**** TODO plug
*** PENDING task
**** DONE api call
CLOSED: [2013-07-03 mer. 17:18]
**** TODO plug
** TODO Sync [0%]
*** TODO Given a trello board, download into org-mode file
*** TODO Given a org-mode file, fill in the board
Dismiss non compatible org-mode entries
** TODO Make an interactive setup for retrieving the list ids of the board
This will ease the installation of the list-ids in top of the org file.
Workflow:
- M-x orgtrello-install-list-ids - interactive command to install the board and list ids
- Make a request to list the board ids (name + ids), and display them on a buffer.
- Prompt for the user to choose the board-id he wants
- Make a request to list the different lists and then generate the following properties
#+begin_src txt
# +property: board-id      <board-id>
# +property: todo-list-id  <todo-list-id>
# +property: doing-list-id <doing-list-id>
# +property: done-list-id  <done-list-id>
#+end_src
Note: # + instead of #+ because otherwise, org-mode captures them and overwrite the right ones.
** TODO Make an interactive setup for retrieving the consumer key and the secret-token
This will ease the installation of the *config.el* file
- M-x install-orgtrello
- Make a request on https://trello.com/1/appKey/generate
- Retrieve the consumer-key
- Make a request on
  https://trello.com/1/authorize?response_type=token&name=org-trello&scope=read,write&expiration=never&key=<consumer-key>
and let the browser opens
- Prompt for the user to input its token
- Generate the following file *~/.trello/config.el*
#+begin_src emacs-lisp
;; from: https://trello.com/1/appKey/generate
(defvar consumer-key "<consumer-key>")
;; from: https://trello.com/1/authorize?response_type=token&name=org-trello&scope=read,write&expiration=never&key=<consumer-key>
(defvar access-token "<access-token>")
#+end_src
- Display what has been done to the user's filesystem by showing the content of *~/.trello/config.el*.

** TODO Improvments
*** TODO Improve the synchronous creation of cards (and sub-elements...) to avoid the emacs blocking
*** TODO Rewrite tests using `expectations` (mock)                    :dev:

** PENDING Packaging
*** DONE Make a multi-file package
CLOSED: [2013-07-03 mer. 18:44]
*** DONE Deal with generate the version
CLOSED: [2013-07-03 mer. 18:44]
*** TODO Make a release on marmalade/melpa
- Look at org2blog repository for example
- Search for a tutorial

* Questions
** How to persist the identifier?
We use tag at the moment.
** How to deal with promotion/demotion?
We do not deal with it at the moment.
Idea: - demotion: remove the card and add the checklist or the task to the card if need be
      - promotion: remove the checklist and create the card if need be
      - promotion: the item and create the checklist if need be
???

Dependencies:
- Delete must be implemented.
- Create card with full arborescence must also be implemented.

** Import - Existing and compatible org-mode file into trello?
** Export - Existing trello board into org-mode file?
* TODO card for testing
** TODO checklist 0
*** task1
*** task2
*** DONE task3
CLOSED: [2013-07-03 mer. 09:26]
** IN-PROGRESS checklist 1
** TODO another deep checklists
*** DONE do
CLOSED: [2013-07-03 mer. 14:19]
*** DONE you
CLOSED: [2013-07-03 mer. 14:19]
*** DONE like it
CLOSED: [2013-07-03 mer. 14:18]
** IN-PROGRESS Does this work or not?
*** TODO yes
*** empty
*** no
